
-- Step 1: Add source tracking columns if they don't exist
ALTER TABLE identified_companies 
ADD COLUMN IF NOT EXISTS source VARCHAR(50) DEFAULT 'job_analysis',
ADD COLUMN IF NOT EXISTS import_date TIMESTAMP WITH TIME ZONE;

-- Create index for source filtering
CREATE INDEX IF NOT EXISTS idx_identified_companies_source ON identified_companies(source);

-- Step 2: Mark all Google Sheets companies (677 companies)
UPDATE identified_companies
SET 
  source = 'google_sheets',
  import_date = '2025-06-26T00:00:00Z'
WHERE id IN (
  '511',
  '202',
  '759',
  '705',
  '499',
  '157',
  '236',
  '313',
  '381',
  '136',
  '46',
  '63',
  '98',
  '556',
  '81',
  '522',
  '170',
  '547',
  '257',
  '553',
  '6',
  '19',
  '189',
  '122',
  '530',
  '302',
  '79',
  '445',
  '225',
  '645',
  '112',
  '37',
  '590',
  '317',
  '301',
  '348',
  '636',
  '414',
  '482',
  '331',
  '608',
  '846',
  '267',
  '67',
  '400',
  '273',
  '422',
  '135',
  '449',
  '704',
  '469',
  '426',
  '587',
  '387',
  '664',
  '498',
  '292',
  '363',
  '602',
  '208',
  '678',
  '132',
  '600',
  '568',
  '559',
  '251',
  '627',
  '283',
  '245',
  '388',
  '42',
  '213',
  '117',
  '791',
  '487',
  '428',
  '73',
  '599',
  '50',
  '682',
  '95',
  '675',
  '616',
  '570',
  '605',
  '466',
  '464',
  '668',
  '683',
  '325',
  '120',
  '272',
  '258',
  '62',
  '26',
  '196',
  '110',
  '140',
  '158',
  '442',
  '465',
  '114',
  '951',
  '334',
  '322',
  '859',
  '311',
  '611',
  '621',
  '39',
  '544',
  '687',
  '278',
  '97',
  '330',
  '479',
  '665',
  '781',
  '653',
  '211',
  '404',
  '305',
  '310',
  '494',
  '266',
  '143',
  '550',
  '321',
  '580',
  '513',
  '94',
  '663',
  '223',
  '184',
  '181',
  '378',
  '454',
  '455',
  '397',
  '210',
  '254',
  '551',
  '231',
  '701',
  '515',
  '441',
  '329',
  '195',
  '259',
  '206',
  '326',
  '546',
  '277',
  '280',
  '168',
  '174',
  '204',
  '631',
  '501',
  '500',
  '582',
  '588',
  '138',
  '639',
  '320',
  '344',
  '613',
  '248',
  '70',
  '139',
  '146',
  '656',
  '532',
  '173',
  '443',
  '586',
  '549',
  '504',
  '519',
  '654',
  '693',
  '92',
  '147',
  '167',
  '507',
  '104',
  '505',
  '28',
  '635',
  '423',
  '666',
  '52',
  '118',
  '179',
  '148',
  '543',
  '552',
  '386',
  '340',
  '290',
  '77',
  '598',
  '434',
  '1',
  '343',
  '518',
  '512',
  '484',
  '124',
  '175',
  '339',
  '53',
  '289',
  '183',
  '349',
  '375',
  '625',
  '495',
  '692',
  '589',
  '12',
  '638',
  '661',
  '102',
  '528',
  '474',
  '99',
  '657',
  '641',
  '109',
  '87',
  '11',
  '90',
  '49',
  '29',
  '76',
  '303',
  '9',
  '596',
  '359',
  '609',
  '235',
  '429',
  '270',
  '390',
  '358',
  '23',
  '255',
  '405',
  '437',
  '342',
  '510',
  '21',
  '285',
  '401',
  '575',
  '606',
  '468',
  '242',
  '38',
  '577',
  '142',
  '45',
  '629',
  '64',
  '337',
  '93',
  '31',
  '279',
  '151',
  '640',
  '116',
  '103',
  '20',
  '535',
  '149',
  '238',
  '126',
  '463',
  '676',
  '253',
  '256',
  '269',
  '86',
  '354',
  '191',
  '361',
  '172',
  '548',
  '502',
  '164',
  '357',
  '233',
  '36',
  '96',
  '80',
  '144',
  '128',
  '431',
  '566',
  '265',
  '333',
  '473',
  '416',
  '493',
  '228',
  '13',
  '162',
  '190',
  '573',
  '446',
  '539',
  '902',
  '240',
  '107',
  '188',
  '452',
  '198',
  '218',
  '276',
  '308',
  '362',
  '328',
  '115',
  '472',
  '156',
  '355',
  '529',
  '702',
  '620',
  '490',
  '637',
  '352',
  '129',
  '161',
  '542',
  '197',
  '353',
  '186',
  '55',
  '264',
  '119',
  '379',
  '489',
  '578',
  '169',
  '34',
  '604',
  '545',
  '450',
  '562',
  '201',
  '537',
  '477',
  '520',
  '486',
  '75',
  '207',
  '402',
  '485',
  '467',
  '243',
  '212',
  '370',
  '669',
  '220',
  '35',
  '617',
  '524',
  '332',
  '642',
  '597',
  '71',
  '594',
  '314',
  '209',
  '679',
  '444',
  '506',
  '393',
  '563',
  '176',
  '219',
  '652',
  '538',
  '476',
  '284',
  '365',
  '16',
  '650',
  '166',
  '44',
  '316',
  '41',
  '246',
  '347',
  '335',
  '480',
  '572',
  '261',
  '226',
  '430',
  '380',
  '660',
  '229',
  '398',
  '105',
  '619',
  '531',
  '281',
  '367',
  '350',
  '497',
  '684',
  '300',
  '581',
  '160',
  '268',
  '366',
  '377',
  '215',
  '8',
  '585',
  '275',
  '106',
  '433',
  '385',
  '78',
  '58',
  '33',
  '488',
  '187',
  '338',
  '133',
  '540',
  '376',
  '222',
  '4',
  '391',
  '171',
  '299',
  '565',
  '558',
  '241',
  '574',
  '576',
  '237',
  '72',
  '247',
  '591',
  '427',
  '271',
  '374',
  '688',
  '492',
  '438',
  '364',
  '462',
  '655',
  '294',
  '111',
  '369',
  '199',
  '131',
  '508',
  '315',
  '165',
  '155',
  '346',
  '435',
  '624',
  '681',
  '312',
  '571',
  '178',
  '541',
  '618',
  '192',
  '137',
  '134',
  '250',
  '658',
  '561',
  '341',
  '32',
  '628',
  '410',
  '403',
  '509',
  '85',
  '193',
  '408',
  '424',
  '694',
  '304',
  '203',
  '360',
  '74',
  '27',
  '418',
  '470',
  '221',
  '216',
  '249',
  '593',
  '691',
  '82',
  '59',
  '614',
  '40',
  '673',
  '630',
  '481',
  '460',
  '288',
  '217',
  '24',
  '421',
  '309',
  '496',
  '533',
  '54',
  '409',
  '555',
  '180',
  '415',
  '699',
  '68',
  '121',
  '224',
  '458',
  '230',
  '383',
  '623',
  '293',
  '57',
  '60',
  '406',
  '554',
  '703',
  '564',
  '84',
  '395',
  '125',
  '30',
  '680',
  '622',
  '389',
  '327',
  '457',
  '503',
  '557',
  '491',
  '345',
  '567',
  '417',
  '163',
  '612',
  '459',
  '647',
  '43',
  '83',
  '583',
  '51',
  '690',
  '262',
  '526',
  '686',
  '651',
  '286',
  '296',
  '603',
  '18',
  '521',
  '615',
  '659',
  '101',
  '677',
  '260',
  '382',
  '177',
  '336',
  '579',
  '159',
  '89',
  '634',
  '48',
  '298',
  '633',
  '525',
  '394',
  '697',
  '141',
  '371',
  '670',
  '194',
  '185',
  '419',
  '667',
  '145',
  '514',
  '425',
  '695',
  '447',
  '407',
  '646',
  '65',
  '100',
  '351',
  '448',
  '384',
  '698',
  '584',
  '5',
  '527',
  '113',
  '263',
  '478',
  '69',
  '607',
  '456',
  '232',
  '516',
  '440',
  '601',
  '451',
  '644',
  '3',
  '56',
  '205',
  '319',
  '632',
  '274',
  '234',
  '318',
  '287',
  '626',
  '517',
  '150',
  '14',
  '227',
  '356',
  '471',
  '66',
  '649',
  '47',
  '10',
  '127',
  '123',
  '420',
  '483',
  '569',
  '412',
  '671',
  '523',
  '200',
  '461',
  '439',
  '672',
  '432',
  '214',
  '536',
  '15',
  '239',
  '700',
  '152',
  '534',
  '689',
  '696',
  '2',
  '662',
  '595',
  '789',
  '453',
  '782',
  '779',
  '778'
);

-- Step 3: Mark all new discoveries (103 companies)
UPDATE identified_companies
SET 
  source = 'job_analysis',
  import_date = identified_date
WHERE id IN (
  '560',
  '715',
  '977',
  '960',
  '725',
  '888',
  '182',
  '1003',
  '978',
  '775',
  '788',
  '752',
  '252',
  '911',
  '886',
  '91',
  '436',
  '877',
  '774',
  '810',
  '980',
  '61',
  '948',
  '896',
  '297',
  '872',
  '17',
  '22',
  '592',
  '998',
  '926',
  '806',
  '392',
  '372',
  '373',
  '716',
  '825',
  '876',
  '984',
  '291',
  '368',
  '740',
  '929',
  '954',
  '814',
  '737',
  '895',
  '25',
  '413',
  '941',
  '154',
  '871',
  '918',
  '807',
  '959',
  '88',
  '685',
  '808',
  '772',
  '894',
  '1001',
  '850',
  '411',
  '898',
  '282',
  '934',
  '874',
  '899',
  '879',
  '130',
  '780',
  '1005',
  '324',
  '921',
  '924',
  '323',
  '396',
  '475',
  '758',
  '7',
  '999',
  '848',
  '643',
  '920',
  '610',
  '714',
  '956',
  '726',
  '882',
  '985',
  '108',
  '885',
  '710',
  '868',
  '648',
  '711',
  '862',
  '744',
  '768',
  '674',
  '973',
  '845',
  '912'
);

-- Step 4: Verify the update
SELECT 
  source,
  COUNT(*) as count,
  MIN(identified_date) as earliest,
  MAX(identified_date) as latest
FROM identified_companies
GROUP BY source
ORDER BY source;
